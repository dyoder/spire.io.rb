<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: README</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'><h1>Synopsis</h1>

<p><code>spire.io.rb</code> is a Ruby client for the <a href="http://www.spire.io/">spire.io API</a>.</p>

<h2>Basic usage</h2>

<p>The <code>Spire</code> class provides a simplified spire.io client with a high level interface.  Users of this class do not have to pay attention to details of the REST API.
Here&#39;s an example using the message service.  It assumes you have an account key, which you can get by registering at <a href="http://www.spire.io/register.html">www.spire.io</a></p>

<pre class="code ruby"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spire_io</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spire'>spire</span> <span class='op'>=</span> <span class='const'>Spire</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_spire'>spire</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span> <span class='comment'># key is your account key
</span><span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='id identifier rubyid_spire'>spire</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arbitrary channel name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello World!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<p>Let&#39;s create a second session and get our messages.</p>

<pre class="code ruby"><code><span class='id identifier rubyid_spire2'>spire2</span> <span class='op'>=</span> <span class='const'>Spire</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_spire2'>spire2</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
<span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>=</span> <span class='id identifier rubyid_spire2'>spire2</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my subscription</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arbitrary channel name</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='comment'># =&gt; &quot;Hello World!&quot;
</span></code></pre>

<p>You can also assign listener blocks to a subscription which will be called with each message received:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_spire3'>spire3</span> <span class='op'>=</span> <span class='const'>Spire</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_spire3'>spire3</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
<span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>=</span> <span class='id identifier rubyid_spire3'>spire3</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>another subscription</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>arbitrary channel name</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_add_listener'>add_listener</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got a message: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
<span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_start_listening'>start_listening</span>
</code></pre>

<p>The subscription object will continue to monitor the channel until you call <code>#stop_listening</code> on it.</p>

<p>You can add as many listeners as you want.  They can be removed by name:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_listener_name'>listener_name</span> <span class='op'>=</span> <span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_add_listener'>add_listener</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got a message: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
<span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_remove_listener'>remove_listener</span><span class='lparen'>(</span><span class='id identifier rubyid_listener_name'>listener_name</span><span class='rparen'>)</span>
</code></pre>

<p>You can also assign your own name when you add the listener as well:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_add_listener'>add_listener</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Listener1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got a message: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
<span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_remove_listener'>remove_listener</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Listener1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<p><strong>Note:</strong> Listener blocks are executed in separate threads, so please be careful when accessing shared resources.</p>

<h2>Low level interface</h2>

<p>The <code>Spire::API</code> class provides a low level spire.io client that allows you to work directly with the REST API.  The higher level <code>Spire</code> class is a wrapper around this foundation.  Where <code>Spire</code> hides the underlying HTTP traffic from the developer, sometimes making multiple requests within a single method call, <code>Spire::API</code> typically makes one request per method and expects the developer to deal with the consequences.  It also (optionally) exposes the actual HTTP requests used to interact with spire.io.</p>

<p>Usage:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spire/api</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_api'>api</span> <span class='op'>=</span> <span class='const'>Spire</span><span class='op'>::</span><span class='const'>API</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_api'>api</span><span class='period'>.</span><span class='id identifier rubyid_discover'>discover</span>
<span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_api'>api</span><span class='period'>.</span><span class='id identifier rubyid_create_session'>create_session</span><span class='lparen'>(</span><span class='id identifier rubyid_account_key'>account_key</span><span class='rparen'>)</span>
<span class='comment'># session.channels is a memoizing method.
</span><span class='comment'># If the session has already retrieved the channels
</span><span class='comment'># collection, the cached version is returned.
</span><span class='kw'>unless</span> <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_channels'>channels</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_create_channel'>create_channel</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'># if the channel named &quot;foo&quot; already exists,
</span>  <span class='comment'># Spire::API raises an error.
</span>  <span class='kw'>rescue</span>
    <span class='comment'># session.channels! always requests the channels
</span>    <span class='comment'># collection, ovewriting the cached version. 
</span>    <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_channels!'>channels!</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_create_subscription'>create_subscription</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sub.name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message content</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_messages'>messages</span> <span class='op'>=</span> <span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_retrieve_messages'>retrieve_messages</span>
<span class='id identifier rubyid_last_timestamp'>last_timestamp</span> <span class='op'>=</span> <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timestamp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

<span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>another message</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_messages'>messages</span> <span class='op'>=</span> <span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_retrieve_messages'>retrieve_messages</span><span class='lparen'>(</span><span class='symbol'>:last</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_last_timestamp'>last_timestamp</span><span class='rparen'>)</span>
</code></pre>

<h2>CLI usage</h2>

<p>You can also use the client from your shell</p>

<pre class="code ruby"><code># Get help and a list of all the commands supported:
&gt; spire -h
</code></pre>

<p>i.e.
    # Open up an IRB session with an open spire session.
    &gt; spire console (-k KEY | -e EMAIL)</p>

<pre class="code ruby"><code># once in IRB you get an authenticated Spire object
&gt;&gt; $spire.discover      // get the API description
&gt;&gt; $spire.channels      // get a list of Channels
</code></pre>

<p>You can also add a YAML &#39;~/.spirerc&#39; file with a hash entry &#39;key&#39; containing your account key</p>

<h2>What is spire.io?</h2>

<p><a href="http://spire.io">spire.io</a> is a platform as service API.</p>

<h2>Working with this library</h2>

<ul>
<li><a href="https://github.com/spire-io/spire.io.rb">source code</a></li>
<li><a href="http://spire-io.github.com/spire.io.rb/">inline documentation</a> (via <a href="https://github.com/lsegal/yard">yardoc</a>)</li>
<li><a href="https://github.com/spire-io/spire.io.rb/issues">issues</a></li>
<li><a href="http://spire.io/contact.html">contact spire.io</a></li>
</ul>

<h1>Installation</h1>

<p>To install the latest release from rubygems.org:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_spire_io'>spire_io</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_pre'>pre</span>
</code></pre>

<p>If you&#39;re managing dependencies with Bundler, you can refer to this repo in your Gemfile, optionally specifying a branch or tag:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spire_io</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbol'>:git</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git://github.com/spire-io/spire.io.rb.git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbol'>:branch</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>master</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>You can also clone the repo and manage your load path in the old fashioned way. E.g.:</p>

<pre class="code ruby"><code>irb -I /path/to/spire_io/lib
</code></pre>

<p>Or clone, build, and install the gem:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_install'>install</span>
</code></pre>

<h1>Development</h1>

<h2>Tests</h2>

<p>The test suite can be run via:</p>

<pre class="code ruby"><code><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_test'>test</span>
</code></pre>

<h1>Contributing</h1>

<p>Fork and send pull requests via github, also any <a href="https://github.com/spire-io/spire.io.rb/issues">issues</a> are always welcome</p>

<h1>License</h1>

<p>Open Source Initiative OSI - The MIT License (MIT):Licensing</p>

<p>MIT LICENSE
Copyright (c) 2011 spire.io</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div></div>
    
    <div id="footer">
  Generated on Tue Feb 14 17:34:43 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>